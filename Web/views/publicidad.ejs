<!DOCTYPE html>
<html>
<%- include('header.ejs') %>
<body>
	<%- include('navbar.ejs') %>

	<div class="container pt-70">


		<% if (!user) { %>
		<%- include('403.ejs') %>

		<% } else { %>

		<h1 class ='align-center animated fadeIn mt-20' style="text-shadow: 3px 3px 0px rgba(0,0,0,0.2);"> Publicidades </h1>
		<br>
		<div class="container pr-100 pl-100">
			<div class="align-center animated zoomInUp" style="display: none;" id="containerTextAgregar">
				<p id="agregarEjercioText"> Agregar Publicidad </p>
			</div>
			<button type="button" class="btn btn-primary btn-fab" id="agregarEjercio" data-toggle="modal" data-target="#modalAgregarEjercicio">
				<i class="material-icons">add</i>
			</button>

			<br>
			<br>

			<table id="pubTable" class="table table-striped table-bordered animated fadeIn" cellspacing="0" width="100%">
				<thead>
					<tr>
						<th>Nombre</th>
						<th>Regiones</th>
						<th>Fecha Agregada</th>
						<th>Banner</th>
						<th>Editar</th>
						<th>Eliminar</th>
					</tr>
				</thead>
				<tfoot>
					<tr>
						<th>Nombre</th>
						<th>Regiones</th>
						<th>Fecha Agregada</th>
						<th>Banner</th>
						<th>Editar</th>
						<th>Eliminar</th>
					</tr>
				</tfoot>
				<tbody id="tablaDeEjercicios">

				</tbody>
			</table>
		</div>

		<div class="modal fade" id="modalAgregarEjercicio">
			<div class="modal-dialog" role="document">
				<div class="modal-content">
					<div class="modal-header">
						<h2 class="modal-title">Agregar Publicidad</h2>
						<button type="button" class="close" data-dismiss="modal" aria-label="Close">
							<span aria-hidden="true">&times;</span>
						</button>
					</div>
					<div class="modal-body">

						<form method="POST" action="./api/publicidad" enctype="multipart/form-data">

							<div class="form-group">
								<label for="project-title">Nombre:</label>
								<input class="form-control" type="text" name="pubName" placeholder="Ingresa el nombre de la publicidad" id="pubName">
							</div>
							<div class="form-group">
								<label for="project-description">URL de la Publicidad:</label>
								<input type="url" class="form-control" name="pubUrl" rows="2" placeholder="URL a donde a donde dirige la publicidad." id="pubUrl">
							</div>
							<div class = 'form-group'>
								<label for="pubImg">Subir Imagen:</label>
								<input type="file" name="upl"/>
							</div>

							<div class="form-group">
								<div class = 'row pt-15'>
									<div class = 'col-md-3 col-xs-6'>
										<label for="project-description">Region(es)</label>
										<select class="form-control"  name="pubRegion">
                                            <option>ECU</option>
											<option>UIO</option>
											<option>GYE</option>
											<option>CUE</option>
										</select>
									</div>
								</div>
							</div>

							<button type="submit" class="btn btn-primary">Guardar</button>
						</form>
					</div>
				</div>
			</div>
		</div>

	<% } %>

		</div>
	<%- include('footer.ejs') %>

	<script type="text/javascript" charset="utf-8">

				$("#agregarEjercio").hover(function(){
						console.log('hola');
						$('#containerTextAgregar').css('display', 'inline')
						$('#containerTextAgregar').attr('class','align-center animated zoomInUp');
				}, function(){
						$('#containerTextAgregar').css('display', 'inline')
						$('#containerTextAgregar').attr('class','align-center animated fadeOutDown');
				});

        $.get("./api/publicidad", function(data){
            console.log(data);
            for (var i = 0; i < data.length; i++){
                var reg = data[i];
                var regiones = "";
                for (var j = 0; j < reg.region.length; j++){
                    regiones = regiones + reg.region[j] + " ";
                }
                var imagen = "<img src = '"+reg.url_imagen+"' class = 'img-responsive align-center' style='width: 112px; height: 30px;'>";
                $("#pubTable").append("<tr><td>"+reg.nombre+"</td><td>"+regiones+"</td><td>"+reg.fechaAgregada+"</td><td>"+imagen+"</td><td><button type='button' onclick='location.href=#' class='btn btn-default editar-publicidad' id='pub-"+reg.id+"'><span class='glyphicon glyphicon-pencil' aria-hidden='true'></span></button></td><td><button type='button' class='btn btn-default eliminar-publicidad' id='pub-"+reg.id+"'><span class='glyphicon glyphicon-remove' aria-hidden='true'></span></button></td>"+"</tr>")
            }

        $(".eliminar-publicidad").click(function(){
            var idPubDel = this.id.split("-")[1];
            var url = "./api/publicidad/"+idPubDel;
            $.ajax({
                url: url,
                type: 'DELETE',
                success: function(result){
                }
            })
            location.reload();
        });

        $('#pubTable').DataTable();

    });

	</script>


</body>
</html>
